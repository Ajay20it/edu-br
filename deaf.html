<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduBridge - Inclusive Learning Platform for Deaf & Blind Community</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #7ED321;
            --background-light: #F8F9FA;
            --background-dark: #1A1A1A;
            --text-light: #333;
            --text-dark: #E0E0E0;
            --accent-color: #FF6B6B;
            --success-color: #50C878;
        }

        [data-theme="dark"] {
            --bg-color: var(--background-dark);
            --text-color: var(--text-dark);
            --card-bg: #2D2D2D;
        }

        [data-theme="light"] {
            --bg-color: var(--background-light);
            --text-color: var(--text-light);
            --card-bg: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'OpenDyslexic', Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .dyslexia-friendly {
            font-family: 'OpenDyslexic', 'Comic Sans MS', Arial, sans-serif;
            letter-spacing: 0.12em;
            word-spacing: 0.16em;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-secondary {
            background: var(--accent-color);
            color: white;
        }

        .btn-toggle {
            background: var(--success-color);
            color: white;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .status.listening {
            background: linear-gradient(45deg, #FF6B6B, #FFE66D);
            animation: pulse 2s infinite;
        }

        .status.stopped {
            background: #E0E0E0;
            color: #666;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .caption-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            min-height: 200px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-color);
        }

        .caption-text {
            font-size: 1.8rem;
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .emoji-display {
            font-size: 3rem;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            margin-top: 15px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .emoji-item {
            display: inline-block;
            animation: bounceIn 0.6s ease;
            margin: 5px;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .learning-mode {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .word-game {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .word-option {
            padding: 15px 25px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .word-option:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }

        .word-option.correct {
            background: var(--success-color);
            animation: celebrate 0.6s ease;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .score {
            text-align: center;
            font-size: 1.5rem;
            margin: 15px 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .accessibility-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .toggle-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(30px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .caption-text {
                font-size: 1.4rem;
            }
            
            .emoji-display {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Screen Reader and Blind User Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .focus-visible {
            outline: 3px solid var(--accent-orange);
            outline-offset: 2px;
        }

        /* High contrast mode for low vision users */
        .high-contrast {
            filter: contrast(200%) brightness(120%);
        }

        .high-contrast .header {
            background: #000000;
            color: #ffffff;
        }

        .high-contrast .nav-tab {
            background: #ffffff;
            color: #000000;
            border: 3px solid #000000;
        }

        .high-contrast .nav-tab.active {
            background: #000000;
            color: #ffffff;
        }

        .high-contrast .visual-card {
            background: #ffffff;
            border: 3px solid #000000;
            color: #000000;
        }

        /* Audio controls for blind users */
        .audio-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            z-index: 1000;
        }

        .audio-controls button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Voice navigation indicators */
        .voice-active {
            border: 3px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        /* Keyboard navigation improvements */
        *:focus {
            outline: 3px solid var(--accent-orange);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--neutral-900);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Large text mode */
        .large-text {
            font-size: 1.25em;
        }

        .large-text h1 { font-size: 4.5rem; }
        .large-text h2 { font-size: 2.75rem; }
        .large-text h3 { font-size: 1.75rem; }
        .large-text p { font-size: 1.25rem; }
        .large-text .btn { font-size: 1.25rem; padding: 1rem 2rem; }

        /* Screen reader announcements */
        .announcement {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Audio feedback indicators */
        .audio-feedback {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            z-index: 1000;
            display: none;
        }

        /* Toggle Switch Styles */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-blue);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body data-theme="light" role="document">
    <div class="navigation">
        <a href="index.html" class="nav-btn">← Back to Home</a>
    </div>

    <!-- Skip to main content link for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Audio controls for blind users -->
    <div class="audio-controls" id="audioControls" role="region" aria-label="Audio Controls">
        <button onclick="toggleAudioDescription()" aria-label="Toggle audio descriptions">🔊 Audio</button>
        <button onclick="toggleVoiceNavigation()" aria-label="Toggle voice navigation">🎤 Voice Nav</button>
        <button onclick="toggleScreenReader()" aria-label="Toggle screen reader mode">📖 Screen Reader</button>
    </div>

    <!-- Live region for screen reader announcements -->
    <div id="announcements" class="announcement" aria-live="polite" aria-atomic="true"></div>

    <!-- Audio feedback area -->
    <div id="audioFeedback" class="audio-feedback" role="status" aria-live="polite"></div>

    <div class="container">
        <header class="header" role="banner">
            <div class="header-content">
                <h1 id="main-heading" tabindex="0">
                    <i class="fas fa-hands" aria-hidden="true"></i>
                    <span class="sr-only">EduBridge - Hands icon</span>
                    EduBridge
                </h1>
                <p role="doc-subtitle">Empowering the Deaf & Blind Community Through Inclusive Learning & Technology</p>
                <div class="deaf-indicator" role="note">
                    <i class="fas fa-universal-access" aria-hidden="true"></i>
                    <span>Optimized for Deaf, Blind & Hard of Hearing Users</span>
                </div>
            </div>
        </header>

        <div class="accessibility-panel" role="region" aria-labelledby="accessibility-heading">
            <h3 id="accessibility-heading">♿ Accessibility Settings for Deaf & Blind Users</h3>

            <!-- Visual Accessibility for Deaf Users -->
            <fieldset>
                <legend>👁️ Visual Accessibility (Deaf Users)</legend>
                <div class="toggle-group">
                    <label for="themeToggle">🌙 High Contrast Mode</label>
                    <div class="toggle-switch" id="themeToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="fontToggle">📖 Large Text Mode</label>
                    <div class="toggle-switch" id="fontToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="emojiToggle">😊 Show Visual Emojis</label>
                    <div class="toggle-switch active" id="emojiToggle" role="switch" aria-checked="true" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="captionsToggle">📺 Always Show Captions</label>
                    <div class="toggle-switch active" id="captionsToggle" role="switch" aria-checked="true" tabindex="0"></div>
                </div>
            </fieldset>

            <!-- Audio Accessibility for Blind Users -->
            <fieldset>
                <legend>🔊 Audio Accessibility (Blind Users)</legend>
                <div class="toggle-group">
                    <label for="screenReaderToggle">� Screen Reader Mode</label>
                    <div class="toggle-switch" id="screenReaderToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="audioDescriptionToggle">🎵 Audio Descriptions</label>
                    <div class="toggle-switch" id="audioDescriptionToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="voiceNavigationToggle">🎤 Voice Navigation</label>
                    <div class="toggle-switch" id="voiceNavigationToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="audioFeedbackToggle">🔔 Audio Feedback</label>
                    <div class="toggle-switch active" id="audioFeedbackToggle" role="switch" aria-checked="true" tabindex="0"></div>
                </div>
            </fieldset>

            <!-- Learning Mode -->
            <fieldset>
                <legend>🎮 Learning Options</legend>
                <div class="toggle-group">
                    <label for="gameToggle">🎯 Interactive Learning Mode</label>
                    <div class="toggle-switch" id="gameToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
                <div class="toggle-group">
                    <label for="slowModeToggle">🐌 Slow Mode (Extra Time)</label>
                    <div class="toggle-switch" id="slowModeToggle" role="switch" aria-checked="false" tabindex="0"></div>
                </div>
            </fieldset>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="startBtn">🎤 Start Listening</button>
            <button class="btn btn-secondary" id="stopBtn">⏹️ Stop</button>
            <button class="btn btn-toggle" id="clearBtn">🗑️ Clear</button>
        </div>

        <div class="status stopped" id="status">
            Ready to listen! Click "Start Listening" to begin.
        </div>

        <div class="caption-container">
            <div class="caption-text" id="captionText">
                Your speech will appear here with emoji translations...
            </div>
            <div class="emoji-display" id="emojiDisplay">
                🎯 Ready to learn!
            </div>
        </div>

        <div class="learning-mode hidden" id="learningMode">
            <h3>🎮 Learning Game</h3>
            <p>Which word matches this emoji?</p>
            <div class="emoji-display" id="gameEmoji">😊</div>
            <div class="word-game" id="wordGame"></div>
            <div class="score" id="score">Score: 0</div>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🎤</div>
                <h3>Real-Time Transcription</h3>
                <p>Convert speech to text instantly using advanced browser APIs</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">😊</div>
                <h3>Emoji Mapping</h3>
                <p>Visual symbols help associate words with emotions and actions</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3>Accessibility First</h3>
                <p>Designed for deaf, neurodivergent, and visual learners</p>
            </div>
        </div>

        <!-- YouTube Video Embed -->
        <div class="video-section" style="margin-bottom:30px;">
            <div style="margin-top:10px; color:#d9534f; font-size:1em;">
                To use transcription and emoji mapping, please download the video and upload it using the file input below.
            </div>
            <input type="file" id="videoInput" accept="video/*" style="margin-top:15px;">
            <video id="videoPlayer" width="480" controls style="display:block; margin-top:10px;">
                <source src="C:/Users/Asus/OneDrive/Desktop/CD Projekt Red/abdul part/eduvid.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <button class="btn btn-primary" id="transcribeBtn" style="margin-top:10px;">Transcribe Video Audio</button>
            <div id="emojiParagraphOutput" style="margin-top:20px; background:#fffbe6; border-radius:10px; padding:18px; font-size:1.4em; color:#333; box-shadow:0 2px 8px rgba(0,0,0,0.07); min-height:60px;"></div>
        </div>
    </div>

    <script>
        // Emoji mapping dictionary
        const emojiMap = {
            // Emotions
            'happy': '😊', 'joy': '😊', 'smile': '😊', 'glad': '😊',
            'sad': '😢', 'cry': '😢', 'upset': '😢', 'down': '😢',
            'angry': '😠', 'mad': '😠', 'furious': '😠', 'rage': '😠',
            'love': '❤️', 'heart': '❤️', 'like': '👍', 'good': '👍',
            'surprised': '😲', 'wow': '😲', 'amazing': '😲',
            'scared': '😨', 'afraid': '😨', 'fear': '😨',
            'excited': '🎉', 'party': '🎉', 'celebrate': '🎉',
            
            // Actions
            'eat': '🍽️', 'food': '🍽️', 'hungry': '🍽️', 'meal': '🍽️',
            'drink': '🥤', 'water': '💧', 'thirsty': '🥤',
            'sleep': '😴', 'tired': '😴', 'bed': '🛏️', 'rest': '😴',
            'run': '🏃', 'walk': '🚶', 'exercise': '🏃', 'move': '🚶',
            'read': '📖', 'book': '📖', 'study': '📚', 'learn': '🎓',
            'write': '✍️', 'pen': '✍️', 'pencil': '✏️',
            'play': '🎮', 'game': '🎮', 'fun': '🎮', 'toy': '🧸',
            'work': '💼', 'job': '💼', 'office': '🏢',
            'drive': '🚗', 'car': '🚗', 'travel': '✈️', 'trip': '✈️',
            
            // Objects
            'phone': '📱', 'computer': '💻', 'laptop': '💻',
            'house': '🏠', 'home': '🏠', 'building': '🏢',
            'tree': '🌳', 'flower': '🌸', 'plant': '🌱',
            'sun': '☀️', 'moon': '🌙', 'star': '⭐', 'sky': '☁️',
            'rain': '🌧️', 'snow': '❄️', 'wind': '💨',
            'music': '🎵', 'song': '🎵', 'sound': '🔊',
            
            // Animals
            'cat': '🐱', 'dog': '🐶', 'bird': '🐦', 'fish': '🐟',
            'elephant': '🐘', 'lion': '🦁', 'tiger': '🐅',
            'rabbit': '🐰', 'bear': '🐻', 'monkey': '🐵',
            
            // Family
            'mom': '👩', 'dad': '👨', 'baby': '👶', 'child': '🧒',
            'family': '👨‍👩‍👧‍👦', 'friend': '👫', 'people': '👥',
            
            // Numbers
            'one': '1️⃣', 'two': '2️⃣', 'three': '3️⃣', 'four': '4️⃣',
            'five': '5️⃣', 'six': '6️⃣', 'seven': '7️⃣', 'eight': '8️⃣',
            'nine': '9️⃣', 'ten': '🔟',
            
            // Colors
            'red': '🔴', 'blue': '🔵', 'green': '🟢', 'yellow': '🟡',
            'orange': '🟠', 'purple': '🟣', 'black': '⚫', 'white': '⚪',
            
            // Time
            'morning': '🌅', 'afternoon': '☀️', 'evening': '🌆', 'night': '🌙',
            'today': '📅', 'tomorrow': '➡️', 'yesterday': '⬅️',
            'time': '⏰', 'clock': '🕐', 'hour': '⏰', 'minute': '⏰',
            
            // School
            'school': '🏫', 'teacher': '👩‍🏫', 'student': '👨‍🎓',
            'class': '📚', 'test': '📝', 'homework': '📋',
            
            // Health
            'doctor': '👩‍⚕️', 'medicine': '💊', 'hospital': '🏥',
            'sick': '🤒', 'healthy': '💪', 'exercise': '🏃‍♂️'
        };

        // Game words for learning mode
        const gameWords = [
            { emoji: '😊', words: ['happy', 'smile', 'glad', 'joy'], correct: 'happy' },
            { emoji: '🐶', words: ['cat', 'dog', 'bird', 'fish'], correct: 'dog' },
            { emoji: '🍽️', words: ['sleep', 'eat', 'run', 'read'], correct: 'eat' },
            { emoji: '🌞', words: ['moon', 'star', 'sun', 'cloud'], correct: 'sun' },
            { emoji: '🚗', words: ['house', 'car', 'tree', 'book'], correct: 'car' },
            { emoji: '❤️', words: ['angry', 'sad', 'love', 'scared'], correct: 'love' },
            { emoji: '📚', words: ['play', 'sleep', 'eat', 'study'], correct: 'study' },
            { emoji: '🏠', words: ['car', 'home', 'tree', 'water'], correct: 'home' }
        ];

        // App state
        let recognition;
        let isListening = false;
        let showEmojis = true;
        let gameMode = false;
        let currentGame = null;
        let score = 0;
        let videoRecognition;
        let videoStream;

        // DOM elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const status = document.getElementById('status');
        const captionText = document.getElementById('captionText');
        const emojiDisplay = document.getElementById('emojiDisplay');
        const themeToggle = document.getElementById('themeToggle');
        const fontToggle = document.getElementById('fontToggle');
        const emojiToggle = document.getElementById('emojiToggle');
        const gameToggle = document.getElementById('gameToggle');
        const learningMode = document.getElementById('learningMode');
        const gameEmoji = document.getElementById('gameEmoji');
        const wordGame = document.getElementById('wordGame');
        const scoreDisplay = document.getElementById('score');
        const videoInput = document.getElementById('videoInput');
        const videoPlayer = document.getElementById('videoPlayer');
        const transcribeBtn = document.getElementById('transcribeBtn');

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                alert('Speech recognition not supported in this browser. Please use Chrome or Firefox.');
                return false;
            }

            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                status.textContent = '🎤 Listening... Speak now!';
                status.className = 'status listening';
                startBtn.textContent = '🎤 Listening...';
                startBtn.disabled = true;
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                const fullText = finalTranscript + interimTranscript;
                captionText.textContent = fullText;

                if (showEmojis) {
                    updateEmojiDisplay(fullText);
                } else {
                    document.getElementById('emojiParagraphOutput').innerHTML = '';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                status.textContent = 'Error: ' + event.error;
                status.className = 'status stopped';
                resetUI();
            };

            recognition.onend = () => {
                isListening = false;
                status.textContent = 'Stopped listening. Click start to begin again.';
                status.className = 'status stopped';
                resetUI();
            };

            return true;
        }

        // Update emoji display based on text
        function updateEmojiDisplay(text) {
            const words = text.toLowerCase().split(/\s+/);
            const emojis = [];
            const usedEmojis = new Set();

            words.forEach(word => {
                // Remove punctuation
                const cleanWord = word.replace(/[^\w]/g, '');
                if (emojiMap[cleanWord] && !usedEmojis.has(cleanWord)) {
                    emojis.push(emojiMap[cleanWord]);
                    usedEmojis.add(cleanWord);
                }
            });

            if (emojis.length > 0) {
                emojiDisplay.innerHTML = emojis.map(emoji => 
                    `<span class="emoji-item">${emoji}</span>`
                ).join('');
                // Also show in dedicated paragraph output
                document.getElementById('emojiParagraphOutput').innerHTML = `<strong>Emoji Paragraph:</strong><br>${emojis.join(' ')}`;
            } else {
                emojiDisplay.innerHTML = '<span class="emoji-item">🎯</span>';
                document.getElementById('emojiParagraphOutput').innerHTML = '<strong>Emoji Paragraph:</strong><br>🎯';
            }
        }

        // Reset UI elements
        function resetUI() {
            startBtn.textContent = '🎤 Start Listening';
            startBtn.disabled = false;
        }

        // Learning game functions
        function startLearningGame() {
            if (!gameMode) return;
            
            currentGame = gameWords[Math.floor(Math.random() * gameWords.length)];
            gameEmoji.innerHTML = `<span class="emoji-item">${currentGame.emoji}</span>`;
            
            // Shuffle words
            const shuffledWords = [...currentGame.words].sort(() => Math.random() - 0.5);
            
            wordGame.innerHTML = shuffledWords.map(word => 
                `<button class="word-option" onclick="checkAnswer('${word}')">${word}</button>`
            ).join('');
        }

        function checkAnswer(selectedWord) {
            const buttons = wordGame.querySelectorAll('.word-option');
            
            if (selectedWord === currentGame.correct) {
                score += 10;
                scoreDisplay.textContent = `Score: ${score}`;
                
                // Find and highlight correct button
                buttons.forEach(btn => {
                    if (btn.textContent === selectedWord) {
                        btn.classList.add('correct');
                    }
                });
                
                // Start new game after delay
                setTimeout(() => {
                    startLearningGame();
                }, 1500);
            } else {
                // Shake incorrect button
                buttons.forEach(btn => {
                    if (btn.textContent === selectedWord) {
                        btn.style.animation = 'shake 0.5s ease';
                        btn.style.background = '#FF6B6B';
                        setTimeout(() => {
                            btn.style.animation = '';
                            btn.style.background = '';
                        }, 500);
                    }
                });
            }
        }

        // Load selected video into player
        videoInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                videoPlayer.src = url;
                videoPlayer.load();
            }
        });

        // Transcribe video audio
        transcribeBtn.addEventListener('click', async function() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                alert('Speech recognition not supported in this browser.');
                return;
            }
            if (!videoPlayer.src) {
                alert('Please select and play a video first.');
                return;
            }

            // Get audio stream from video
            if (!videoStream) {
                try {
                    videoStream = videoPlayer.captureStream();
                } catch (e) {
                    alert('Unable to capture video audio stream.');
                    return;
                }
            }

            // Setup speech recognition for video
            if ('webkitSpeechRecognition' in window) {
                videoRecognition = new webkitSpeechRecognition();
            } else {
                videoRecognition = new SpeechRecognition();
            }
            videoRecognition.continuous = true;
            videoRecognition.interimResults = false;
            videoRecognition.lang = 'en-US';

            let videoTranscript = '';
            videoRecognition.onresult = (event) => {
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        videoTranscript += event.results[i][0].transcript + ' ';
                    }
                }
                // Display transcript and emojis as paragraph
                captionText.textContent = videoTranscript;
                if (showEmojis) {
                    updateEmojiDisplay(videoTranscript);
                } else {
                    document.getElementById('emojiParagraphOutput').innerHTML = '';
                }
            };
            videoRecognition.onerror = (event) => {
                status.textContent = 'Error: ' + event.error;
            };
            videoRecognition.onend = () => {
                status.textContent = 'Video transcription ended.';
            };

            // Start recognition when video plays
            videoPlayer.onplay = () => {
                videoRecognition.start();
                status.textContent = 'Transcribing video audio...';
            };
            videoPlayer.onpause = () => {
                videoRecognition.stop();
                status.textContent = 'Video paused.';
            };
            videoPlayer.onended = () => {
                videoRecognition.stop();
                status.textContent = 'Video ended.';
            };
        });

        // Convert text to emoji paragraph
        function convertTextToEmojiParagraph(text) {
            const words = text.toLowerCase().split(/\s+/);
            return words.map(word => {
                const cleanWord = word.replace(/[^\w]/g, '');
                return emojiMap[cleanWord] ? `${word} ${emojiMap[cleanWord]}` : word;
            }).join(' ');
        }

        // Event listeners
        startBtn.addEventListener('click', () => {
            if (!isListening && recognition) {
                recognition.start();
            }
        });

        stopBtn.addEventListener('click', () => {
            if (isListening && recognition) {
                recognition.stop();
            }
        });

        clearBtn.addEventListener('click', () => {
            captionText.textContent = 'Your speech will appear here with emoji translations...';
            emojiDisplay.innerHTML = '🎯 Ready to learn!';
        });

        // Toggle handlers
        themeToggle.addEventListener('click', () => {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            themeToggle.classList.toggle('active');
        });

        fontToggle.addEventListener('click', () => {
            document.body.classList.toggle('dyslexia-friendly');
            fontToggle.classList.toggle('active');
        });

        emojiToggle.addEventListener('click', () => {
            showEmojis = !showEmojis;
            emojiToggle.classList.toggle('active');
            emojiDisplay.style.display = showEmojis ? 'flex' : 'none';
        });

        gameToggle.addEventListener('click', () => {
            gameMode = !gameMode;
            gameToggle.classList.toggle('active');
            learningMode.classList.toggle('hidden');
            
            if (gameMode) {
                startLearningGame();
            }
        });

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // Automatically start transcription when video plays
        videoPlayer.addEventListener('play', function() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                status.textContent = 'Speech recognition not supported in this browser.';
                return;
            }
            // Get audio stream from video
            if (!videoStream) {
                try {
                    videoStream = videoPlayer.captureStream();
                } catch (e) {
                    status.textContent = 'Unable to capture video audio stream.';
                    return;
                }
            }
            // Setup speech recognition for video
            if ('webkitSpeechRecognition' in window) {
                videoRecognition = new webkitSpeechRecognition();
            } else {
                videoRecognition = new SpeechRecognition();
            }
            videoRecognition.continuous = true;
            videoRecognition.interimResults = false;
            videoRecognition.lang = 'en-US';
            let videoTranscript = '';
            videoRecognition.onresult = (event) => {
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        videoTranscript += event.results[i][0].transcript + ' ';
                    }
                }
                // Display transcript and emojis as paragraph
                captionText.textContent = videoTranscript;
                if (showEmojis) {
                    updateEmojiDisplay(videoTranscript);
                } else {
                    document.getElementById('emojiParagraphOutput').innerHTML = '';
                }
            };
            videoRecognition.onerror = (event) => {
                status.textContent = 'Error: ' + event.error;
            };
            videoRecognition.onend = () => {
                status.textContent = 'Video transcription ended.';
            };
            videoRecognition.start();
            status.textContent = 'Transcribing video audio...';
        });
        videoPlayer.addEventListener('pause', function() {
            if (videoRecognition) {
                videoRecognition.stop();
                status.textContent = 'Video paused.';
            }
        });
        videoPlayer.addEventListener('ended', function() {
            if (videoRecognition) {
                videoRecognition.stop();
                status.textContent = 'Video ended.';
            }
        });

        // Initialize the app
        window.addEventListener('load', () => {
            if (initSpeechRecognition()) {
                console.log('EmojiLearn initialized successfully!');
            }
        });

        // Make checkAnswer globally available
        window.checkAnswer = checkAnswer;

        // ===== COMPREHENSIVE ACCESSIBILITY FEATURES FOR DEAF & BLIND USERS =====

        // Global accessibility state
        let accessibilityState = {
            screenReaderMode: false,
            audioDescriptions: false,
            voiceNavigation: false,
            audioFeedback: true,
            highContrast: false,
            largeText: false,
            slowMode: false,
            currentFocus: null
        };

        // Text-to-Speech for blind users
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        // Audio context for sound feedback
        let audioContext = null;
        let audioEnabled = false;

        // Initialize comprehensive accessibility features
        document.addEventListener('DOMContentLoaded', function() {
            initializeAccessibilityFeatures();
            setupKeyboardNavigation();
            setupVoiceCommands();
            setupAudioFeedback();
            loadAccessibilityPreferences();
        });

        function initializeAccessibilityFeatures() {
            // Setup all accessibility toggle switches
            const toggles = [
                'themeToggle', 'fontToggle', 'emojiToggle', 'captionsToggle',
                'screenReaderToggle', 'audioDescriptionToggle', 'voiceNavigationToggle',
                'audioFeedbackToggle', 'gameToggle', 'slowModeToggle'
            ];

            toggles.forEach(toggleId => {
                const toggle = document.getElementById(toggleId);
                if (toggle) {
                    toggle.addEventListener('click', () => handleAccessibilityToggle(toggleId));
                    toggle.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            handleAccessibilityToggle(toggleId);
                        }
                    });
                }
            });

            // Setup audio controls
            setupAudioControls();
        }

        function handleAccessibilityToggle(toggleId) {
            const toggle = document.getElementById(toggleId);
            const isActive = toggle.classList.contains('active');

            // Toggle visual state
            toggle.classList.toggle('active');
            toggle.setAttribute('aria-checked', !isActive);

            // Handle specific accessibility features
            switch(toggleId) {
                case 'themeToggle':
                    toggleHighContrast(!isActive);
                    break;
                case 'fontToggle':
                    toggleLargeText(!isActive);
                    break;
                case 'screenReaderToggle':
                    toggleScreenReaderMode(!isActive);
                    break;
                case 'audioDescriptionToggle':
                    toggleAudioDescriptions(!isActive);
                    break;
                case 'voiceNavigationToggle':
                    toggleVoiceNavigation(!isActive);
                    break;
                case 'audioFeedbackToggle':
                    toggleAudioFeedback(!isActive);
                    break;
                case 'slowModeToggle':
                    toggleSlowMode(!isActive);
                    break;
            }

            // Provide feedback
            announceToScreenReader(`${toggleId.replace('Toggle', '')} ${!isActive ? 'enabled' : 'disabled'}`);
            playAccessibilitySound(!isActive ? 'enable' : 'disable');
        }

        // High contrast mode for low vision users
        function toggleHighContrast(enable) {
            accessibilityState.highContrast = enable;
            document.body.classList.toggle('high-contrast', enable);
            announceToScreenReader(enable ? 'High contrast mode enabled' : 'High contrast mode disabled');
        }

        // Large text mode
        function toggleLargeText(enable) {
            accessibilityState.largeText = enable;
            document.body.classList.toggle('large-text', enable);
            announceToScreenReader(enable ? 'Large text mode enabled' : 'Large text mode disabled');
        }

        // Screen reader mode with enhanced announcements
        function toggleScreenReaderMode(enable) {
            accessibilityState.screenReaderMode = enable;

            if (enable) {
                // Add more detailed ARIA labels and descriptions
                enhanceScreenReaderSupport();
                announceToScreenReader('Screen reader mode enabled. Enhanced navigation and descriptions are now active.');
            } else {
                announceToScreenReader('Screen reader mode disabled.');
            }
        }

        // Audio descriptions for blind users
        function toggleAudioDescriptions(enable) {
            accessibilityState.audioDescriptions = enable;

            if (enable) {
                startAudioDescriptions();
                announceToScreenReader('Audio descriptions enabled. Visual elements will be described audibly.');
            } else {
                stopAudioDescriptions();
                announceToScreenReader('Audio descriptions disabled.');
            }
        }

        // Voice navigation for hands-free control
        function toggleVoiceNavigation(enable) {
            accessibilityState.voiceNavigation = enable;

            if (enable) {
                startVoiceNavigation();
                announceToScreenReader('Voice navigation enabled. You can now use voice commands to navigate.');
            } else {
                stopVoiceNavigation();
                announceToScreenReader('Voice navigation disabled.');
            }
        }

        // Audio feedback for interactions
        function toggleAudioFeedback(enable) {
            accessibilityState.audioFeedback = enable;

            if (enable) {
                initializeAudioContext();
                announceToScreenReader('Audio feedback enabled.');
            } else {
                announceToScreenReader('Audio feedback disabled.');
            }
        }

        // Slow mode for users who need more time
        function toggleSlowMode(enable) {
            accessibilityState.slowMode = enable;

            if (enable) {
                // Slow down animations and add delays
                document.documentElement.style.setProperty('--animation-duration', '2s');
                announceToScreenReader('Slow mode enabled. Interactions will have more time.');
            } else {
                document.documentElement.style.setProperty('--animation-duration', '0.3s');
                announceToScreenReader('Slow mode disabled.');
            }
        }

        // Screen reader announcements
        function announceToScreenReader(message) {
            const announcements = document.getElementById('announcements');
            if (announcements) {
                announcements.textContent = message;

                // Also use speech synthesis if available
                if (accessibilityState.screenReaderMode && speechSynthesis) {
                    speak(message);
                }
            }
        }

        // Text-to-speech function
        function speak(text, options = {}) {
            if (speechSynthesis && accessibilityState.screenReaderMode) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();

                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.rate = options.rate || 0.8;
                currentUtterance.pitch = options.pitch || 1;
                currentUtterance.volume = options.volume || 0.8;

                speechSynthesis.speak(currentUtterance);
            }
        }
    </script>
</body>
</html>